
<h1>書籍查詢</h1>

<div class="card mb-3">
	<div class="card-header bg-success text-white">查詢條件</div>
	<div class="card-body">
		<div class="row g-2 mb-3">
			<div class="col-md-2">
				<label class="form-label">ISBN</label>
				<input type="text" class="form-control" id="isbnInput" placeholder="978-986-123456-7">
			</div>
			<div class="col-md-5">
				<label class="form-label">書名 / 作者 / 關鍵字</label>
				<input type="text" class="form-control" id="keywordInput" placeholder="例如：村上春樹、機器學習">
			</div>
			<div class="col-md-4">
				<label class="form-label">出版社</label>
				<input type="text" class="form-control" id="publisherInput">
			</div>
			@* <div class="col-md-2 ">
				<label asp-for="Category" class="form-label">書籍分類</label>
				<select asp-for="Category" class="form-select required-field">
					<option value="">請選擇分類</option>
				
				</select>
				<span asp-validation-for="Category" class="text-danger"></span>
			</div> *@
		</div>

		<div class="row g-3">
			<!-- 📗 書本狀態 -->
			<div class="col-md-4">
				<div class="border rounded p-3 h-100">
					<div class="form-check mb-2">
						<input class="form-check-input group-toggle" type="checkbox" id="bookSelectAll" data-group="bookStatus">
						<label class="form-check-label fw-bold" for="bookSelectAll">📗 書本狀態</label>
					</div>
					<div class="d-flex flex-wrap gap-2" data-status-group="bookStatus"></div>
				</div>
			</div>

			<!-- 🔁 借閱狀態 -->
			<div class="col-md-4">
				<div class="border rounded p-3 h-100">
					<div class="form-check mb-2">
						<input class="form-check-input group-toggle" type="checkbox" id="borrowSelectAll" data-group="borrowStatus">
						<label class="form-label fw-bold" for="borrowSelectAll">🔁 借閱狀態</label>
					</div>
					<div class="d-flex flex-wrap gap-2" data-status-group="borrowStatus"></div>
				</div>
			</div>

			<!-- 📦 預約狀態 -->
			<div class="col-md-3">
				<div class="border rounded p-3 h-100">
					<div class="form-check mb-2">
						<input class="form-check-input group-toggle" type="checkbox" id="reserveSelectAll" data-group="reservationStatus">
						<label class="form-label fw-bold" for="reserveSelectAll">📦 預約狀態</label>
					</div>
					<div class="d-flex flex-wrap gap-2" data-status-group="reservationStatus"></div>
				</div>
			</div>

			<div class="col-md-1 d-flex flex-column justify-content-end gap-2">
				<button class="btn btn-outline-secondary w-100" id="btnClear">
					<i class="bi bi-x-circle"></i> 清空
				</button>
				<button class="btn btn-primary w-100" id="btnSearch">
					<i class="bi bi-search"></i> 查詢
				</button>
			</div>
		</div>
	</div>
</div>

@* 狀態標籤專用CSS *@
<style>
	.status-badge {
		font-size: 0.85rem;
		padding: 0.35em 0.75em;
		border-radius: 0.5rem;
		font-weight: 600;
		line-height: 1.2;
	}
</style>

<div class="modal fade" id="bookDetailModal" tabindex="-1">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<!-- 分頁選單 -->
			<ul class="nav nav-tabs mb-3 px-3 pt-3" id="bookTab" role="tablist">
				<li class="nav-item" role="presentation">
					<button class="nav-link active" data-bs-toggle="tab" data-bs-target="#collection" type="button">📘 書籍資訊</button>
				</li>

				<li class="nav-item" role="presentation">
					<button class="nav-link" data-bs-toggle="tab" data-bs-target="#relatedBooks" type="button">📚 其他館藏</button>
				</li>
			</ul>

			<div class="modal-body">
				<div class="tab-content">
					<!-- 📘 書籍資訊 -->
					<div class="tab-pane fade show active" id="collection">
						<div class="container-fluid">
							<div class="row g-3">
								<div class="col-12 text-center">
									<label class="form-label">封面圖片</label><br />
									<img id="editCoverImage"
										 src="https://via.placeholder.com/180x240?text=封面預覽"
										 class="img-thumbnail mb-2"
										 alt="書籍封面"
										 style="max-width: 180px; height: auto;" />

									<!-- 編輯模式顯示：更換圖片按鈕 -->
									<div id="coverImageUploadGroup" class="d-none mt-2" data-section="collection">
										<input type="file" class="form-control w-auto d-inline-block" id="coverImageUpload" accept="image/*" />
										<button class="btn btn-sm btn-outline-secondary ms-2" onclick="removeCoverImage()">移除封面</button>
									</div>
								</div>
								<!-- ISBN -->
								<div class="col-12">
									<label class="form-label">ISBN</label>
									<input type="text" class="form-control" id="editISBN" readonly data-section="collection">
								</div>

								<!-- 書名 -->
								<div class="col-12">
									<label class="form-label">書名</label>
									<input type="text" class="form-control" id="editTitle" readonly data-section="collection">
								</div>

								<!-- 語言 -->
								<div class="col-12" data-edit-group="collection-select">
									<label class="form-label">語言</label>
									<input type="text" class="form-control display" id="editLanguageDisplay" readonly>
									<select class="form-select editor d-none mt-2" id="editLanguageSelect">
										<option value="zh-TW">中文</option>
										<option value="en">English</option>
										<option value="ja">日本語</option>
										<option value="ko">한국어</option>
										<option value="fr">le français</option>
									</select>
								</div>


								<!-- 作者 -->
								<div class="col-12">
									<label class="form-label">作者</label>
									<input type="text" class="form-control" id="editAuthor" readonly data-section="collection">
								</div>

								<!-- 譯者 -->
								<div class="col-12">
									<label class="form-label">譯者</label>
									<input type="text" class="form-control" id="editTranslator" readonly data-section="collection">
								</div>

								<!-- 出版社 -->
								<div class="col-12">
									<label class="form-label">出版社</label>
									<input type="text" class="form-control" id="editPublisher" readonly data-section="collection">
								</div>

								<!-- 出版日期 -->
								<div class="col-12">
									<label class="form-label">出版日期</label>
									<input type="text" class="form-control" id="editPublishDate" readonly data-section="collection">
								</div>

								<!-- 分類 -->
								<div class="col-12" data-edit-group="collection-select">
									<label class="form-label">分類</label>
									<!-- 顯示文字欄位：class="display" -->
									<input type="text" class="form-control display" id="editCategoryDisplay" readonly>
									<select class="form-select editor d-none mt-2" id="editCategorySelect">
										<option>中文圖書</option>
										<option>漫畫</option>
										<option>小說</option>
										<option>青少年圖書</option>
										<option>兒童圖書</option>
									</select>
								</div>


								<!-- 書籍簡介 -->
								<div class="col-12">
									<label class="form-label">書籍簡介</label>
									<textarea class="form-control" id="editDescription" rows="4" readonly></textarea>
								</div>
							</div>
						</div>
					</div>


					<!-- 📚 館藏狀態 -->
					<div class="tab-pane fade" id="relatedBooks">

						<!-- 📚 BookID 快速選擇列 -->
						<div class="d-flex flex-wrap gap-2 mb-3" id="unifiedBookIDList">
							<!-- 按鈕將由 JS 動態產出 -->
						</div>

						<!-- 📘 館藏資訊卡片區 -->
						<div class="container-fluid pt-3" id="unifiedBookDetail">
							<div class="row g-3">
								<!-- 館藏編號（不可編輯）  +當前館藏 -->
								<div class="col-12">
									<div class="col-12">
										<label class="form-label">
											館藏編號：  查詢編號
											<span class="badge bg-primary ms-2" id="currentBookBadge">BK00124</span>
										</label>
									</div>

									<!-- BookID 按鈕群  其他館藏 -->
									<div class="d-flex flex-wrap gap-2 mb-3" id="otherBooksBtnGroup">
										<label class="form-label">其他館藏：</label>
										<!-- 動態產出其他 BookID 按鈕，但排除 current -->
										<button class="btn btn-outline-secondary btn-sm" onclick="loadUnifiedBookDetail('BK00125')">BK00125</button>
										<button class="btn btn-outline-secondary btn-sm" onclick="loadUnifiedBookDetail('BK00126')">BK00126</button>
									</div>

									<!-- 實際欄位（readonly） -->
									<input type="text" class="form-control" id="editUnifiedBookID" readonly data-section="unifiedBook" data-static="true">
								</div>


								<!-- 書本狀態 -->
								<div class="col-12" data-edit-group="unifiedBook-select">
									<label class="form-label">書本狀態</label>
									<input type="text" class="form-control display" id="editUnifiedBookStatusDisplay" readonly>
									<select class="form-select editor d-none mt-2" id="editUnifiedBookStatusSelect">
										<option value="1">可借</option>
										<option value="2">借出中</option>
										<option value="3">已預約</option>
										<option value="4">無法借閱</option>
									</select>
								</div>

								<!-- 借閱狀態 -->
								<div class="col-12" data-edit-group="unifiedBook-select">
									<label class="form-label">借閱狀態</label>
									<input type="text" class="form-control display" id="editUnifiedBorrowingStatusDisplay" readonly>
									<select class="form-select editor d-none mt-2" id="editUnifiedBorrowingStatusSelect">
										<option value="1">借出中</option>
										<option value="2">已歸還</option>
										<option value="3">已逾期</option>
									</select>
								</div>

								<!-- 預約狀態 -->
								<div class="col-12" data-edit-group="unifiedBook-select">
									<label class="form-label">預約狀態</label>
									<input type="text" class="form-control display" id="editUnifiedReservationStatusDisplay" readonly>
									<select class="form-select editor d-none mt-2" id="editUnifiedReservationStatusSelect">
										<option value="1">等待中</option>
										<option value="2">等取書中</option>
									</select>
								</div>

								<!-- 書況 -->
								<div class="col-12" data-edit-group="unifiedBook-select">
									<label class="form-label">書況</label>
									<input type="text" class="form-control display" id="editUnifiedConditionDisplay" readonly>
									<select class="form-select editor d-none mt-2" id="editUnifiedConditionSelect">
										<option>良好</option>
										<option>污損</option>
										<option>破損</option>
										<option>遺失</option>
									</select>
								</div>

								<!-- 入館日期 -->
								<div class="col-12">
									<label class="form-label">入館日期</label>
									<input type="text" class="form-control" id="editUnifiedAddedDate" readonly data-section="unifiedBook" data-static="true">
								</div>
							</div>
						</div>

					</div>
				</div>

				<div class="modal-footer">
					<!-- 預設顯示：編輯 -->
					<button id="btnEdit-collection" onclick="toggleSectionEdit('collection', true)">✏️ 編輯</button>
					<button id="btnConfirm-collection" class="btn d-none">💾 儲存</button>
					<button id="btnCancel-collection" class="btn d-none" onclick="toggleSectionEdit('collection', false)">取消</button>

					<!-- 永遠顯示：關閉（會強制取消編輯） -->
					<button class="btn btn-outline-secondary" data-bs-dismiss="modal" onclick="cancelEdit()">關閉</button>
				</div>


			</div>
		</div>
	</div>
</div>
